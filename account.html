<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er un compte</title>
    <link rel="stylesheet" href="account.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <main>
        <!-- Section d'inscription -->
        <section id="signup">
            <h2>Cr√©er un compte</h2>
            <form id="signup-form">
                <!-- Champ pour l'email -->
                <label for="email">Email :</label>
                <input type="email" id="email" name="email" required>
                
                <!-- Champ pour le mot de passe -->
                <label for="password">Mot de passe :</label>
                <input type="password" id="password" name="password" required>
                
                <!-- Champ pour confirmer le mot de passe -->
                <label for="confirm-password">Confirmez le mot de passe :</label>
                <input type="password" id="confirm-password" name="confirm-password" required>
                
                <!-- Message d'erreur -->
                <p id="error-message" class="error"></p>
                
                <!-- Bouton de soumission -->
                <button type="submit">Inscrivez-vous</button>
                
                <!-- Lien pour se connecter -->
                <p>Vous avez d√©j√† un compte ? <a href="#" id="login-link">Connectez-vous</a></p>
            </form>
            
            <!-- Lien pour continuer sans compte -->
            <a href="#" id="guest-link">Continuer sans compte</a>
        </section>

        <!-- Section de connexion (masqu√©e par d√©faut) -->
        <section id="login" class="hidden">
            <h2>Connexion</h2>
            <form id="login-form">
                <!-- Champ pour l'email -->
                <label for="login-email">Email :</label>
                <input type="email" id="login-email" name="login-email" required>
                
                <!-- Champ pour le mot de passe -->
                <label for="login-password">Mot de passe :</label>
                <input type="password" id="login-password" name="login-password" required>
                
                <!-- Message d'erreur -->
                <p id="login-error-message" class="error"></p>
                
                <!-- Bouton de soumission -->
                <button type="submit">Se connecter</button>
            </form>
            
            <!-- Lien pour revenir √† l'inscription -->
            <p>Vous n'avez pas de compte ? <a href="#" id="signup-link">Inscrivez-vous</a></p>
        </section>
    </main>

    <!-- Notification -->
    <div id="notification" class="hidden"></div>
    
    <script>
    // V√©rifier si l'utilisateur est d√©j√† connect√© au chargement de la page
    window.onload = function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');

            if (isLoggedIn === 'true') {
                // Rediriger vers la page de profil si l'utilisateur est d√©j√† connect√©
                window.location.href = 'Utilisateur.html';
            }
        };

        // Fonction pour afficher une notification
        function showNotification(message, color) {
            let notification = document.getElementById("notification");
            notification.textContent = message;
            notification.style.backgroundColor = color;
            notification.classList.remove("hidden");
            setTimeout(() => notification.classList.add("hidden"), 3000); // Masquer apr√®s 3 secondes
        }

        // Fonction pour valider l'email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Fonction pour valider le mot de passe
        function isValidPassword(password) {
            const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
            return passwordRegex.test(password);
        }

        // Basculer entre l'inscription et la connexion
        document.getElementById("login-link").addEventListener("click", function(event) {
            event.preventDefault();
            document.getElementById("signup").classList.add("hidden");
            document.getElementById("login").classList.remove("hidden");
        });

        document.getElementById("signup-link").addEventListener("click", function(event) {
            event.preventDefault();
            document.getElementById("login").classList.add("hidden");
            document.getElementById("signup").classList.remove("hidden");
        });

        // V√©rifier si les mots de passe correspondent
        document.getElementById("confirm-password").addEventListener("input", function() {
            const password = document.getElementById("password").value;
            const confirmPassword = this.value;
            const matchMessage = document.getElementById("password-match-message");

            if (password === confirmPassword) {
                matchMessage.textContent = "Les mots de passe correspondent !";
                matchMessage.style.color = "green";
            } else {
                matchMessage.textContent = "Les mots de passe ne correspondent pas.";
                matchMessage.style.color = "red";
            }
        });

        // Gestion de la soumission du formulaire d'inscription
        document.getElementById("signup-form").addEventListener("submit", function(event) {
            event.preventDefault(); // Emp√™che l'envoi du formulaire par d√©faut

            // R√©cup√©rer les valeurs du formulaire
            const email = document.getElementById("email").value.trim(); // Supprimer les espaces
            const password = document.getElementById("password").value.trim(); // Supprimer les espaces
            const confirmPassword = document.getElementById("confirm-password").value.trim(); // Supprimer les espaces
            const errorMessage = document.getElementById("error-message");

            // R√©initialiser le message d'erreur
            errorMessage.textContent = "";

            // Valider l'email
            if (!isValidEmail(email)) {
                errorMessage.textContent = "Veuillez entrer une adresse email valide.";
                errorMessage.style.color = "red";
                return;
            }

            // V√©rifier si les mots de passe correspondent
            if (password !== confirmPassword) {
                errorMessage.textContent = "Les mots de passe ne correspondent pas.";
                errorMessage.style.color = "red";
                return;
            }

            // Sauvegarder les informations dans le localStorage
            if (localStorage.getItem("users")) {
                let users = JSON.parse(localStorage.getItem("users"));
                users.push({email: email, password: password});
                localStorage.setItem("users", JSON.stringify(users));
            } else {
                localStorage.setItem("users", JSON.stringify([{email: email, password: password}]));
            }


            // Marquer l'utilisateur comme connect√©
            localStorage.setItem("isLoggedIn", "true");
            localStorage.setItem("currentUser", email);
            localStorage.removeItem("isGuest"); // Supprimer l'√©tat d'invit√©


            // Afficher une notification de succ√®s
            showNotification("F√©licitations ! üéâ Votre compte a √©t√© cr√©√© avec succ√®s.", "green");

            // Rediriger vers la page de profil apr√®s 1 seconde
            setTimeout(() => {
                window.location.href = "Utilisateur.html"; // Redirection vers la page de profil
            }, 1000);
        });

        // Gestion de la soumission du formulaire de connexion
        document.getElementById("login-form").addEventListener("submit", function(event) {
            event.preventDefault();

            // R√©cup√©rer les valeurs du formulaire
            const email = document.getElementById("login-email").value.trim().toLowerCase();
            const password = document.getElementById("login-password").value.trim();
            const errorMessage = document.getElementById("login-error-message");

            // R√©initialiser le message d'erreur
            errorMessage.textContent = "";

            // R√©cup√©rer les informations stock√©es dans le localStorage
            const users = JSON.parse(localStorage.getItem("users")) || [];
            const user = users.find(user => user.email === email && user.password === password);

            // V√©rifier si l'utilisateur existe dans le localStorage
            if (user) {
                // Marquer l'utilisateur comme connect√©
                localStorage.setItem("isLoggedIn", "true");
                localStorage.setItem("currentUser", email);
                localStorage.removeItem("isGuest"); // Supprimer l'√©tat d'invit√©

                // Afficher une notification de succ√®s
                showNotification("Connexion r√©ussie ! Bienvenue.", "green");

                // Rediriger vers la page de profil apr√®s 1 seconde
                setTimeout(() => {
                    window.location.href = "Utilisateur.html";
                }, 1000);
            } else {
                errorMessage.textContent = "Email ou mot de passe incorrect.";
                errorMessage.style.color = "red";
            }
        });

        // Gestion du lien "Continuer sans compte"
        document.getElementById("guest-link").addEventListener("click", function(event) {
            event.preventDefault();
            // Marquer l'utilisateur comme invit√©
            localStorage.setItem("isGuest", "true");

            // Marquer l'utilisateur comme d√©connect√©
            localStorage.setItem("isLoggedIn", "false");

            // Afficher une notification
            showNotification("Vous naviguez en tant qu‚Äôinvit√©(e). Cr√©ez un compte pour acc√©der aux fonctionnalit√©s exclusives !", "blue");

            // Rediriger vers la page des projets apr√®s 1 seconde
            setTimeout(() => {
                window.location.href = "projets.html";
            }, 1000);
        });
    </script>
</body>
</html>